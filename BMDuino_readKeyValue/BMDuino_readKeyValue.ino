/*****************************************************************
File:         BMDuino_readKeyValue.ino
Description:  將 BMK52T016 模組的 IIC 介面連接到 Arduino 的 Wire，
              同時將 INT 介面連接到 Arduino 的 PIN2。
              當按鍵被按下時，Arduino 將透過 I2C 取得按鍵狀態，
              並顯示在序列埠監視器上。
******************************************************************/
//----------外部引用函式區----------------
// 引入 BMK52T016 按鍵模組的專用函式庫標頭檔
#include "BMK52T016.h"

//----------感測物件建立區----------------
// 建立 BMK52T016 類別的物件 BMK52，並指定中斷腳位與 I2C 通訊介面
// 參數說明：
// 第一個參數：中斷腳位編號（此處為 2，對應 Arduino 的 D2 腳）
// 第二個參數：I2C 通訊物件指標（此處使用預設的 Wire）
BMK52T016 BMK52(2, &Wire); // 使用預設 Wire（I2C0）通訊，中斷腳位為 D2

// 以下是針對不同硬體平台或接線方式的替代設定：
// BMK52T016 BMK52(22, &Wire1); // 若在 BMduino 上使用 Wire1（I2C1），請取消此行的註解
// BMK52T016 BMK52(25, &Wire2); // 若在 BMduino 上使用 Wire2（I2C2），請取消此行的註解

// 初始化設定函式，在 Arduino 啟動時只會執行一次
void setup() 
{
    // 初始化 BMK52T016 按鍵模組：
    // 1. 設定 I2C 通訊參數
    // 2. 初始化中斷腳位設定
    // 3. 進行模組內部暫存器的初始設定
    BMK52.begin();
    
    // 啟動序列埠通訊，設定傳輸速率為 9600 bps：
    // 用於將按鍵狀態資訊輸出到電腦的序列埠監視器（Serial Monitor）
    Serial.begin(9600);
}

// 主迴圈函式，Arduino 啟動後會不斷重複執行此函式
void loop() 
{  
    // 檢查 BMK52T016 模組的中斷狀態：
    // getINT() 函式會讀取模組的中斷標誌位
    // 返回值為 0 表示有按鍵事件發生（通常中斷腳位為低電平觸發）
    if(BMK52.getINT() == 0)
    {
        // 輸出提示文字到序列埠
        Serial.print("keyValue:");
        
        // 讀取按鍵值並以二進位格式輸出：
        // 1. readKeyValue()：透過 I2C 讀取按鍵狀態暫存器
        // 2. 返回值是一個位元組（byte），每位元（bit）代表一個按鍵的狀態
        //    位元值為 1 表示對應按鍵未被按下，0 表示被按下（或依模組規格相反）
        // 3. BIN 參數指定以二進位格式顯示，例如：0b00000101 表示第0位和第2位按鍵被按下
        Serial.println(BMK52.readKeyValue(), BIN);
    }  
    
    // 注意：此程式使用輪詢（polling）方式檢查中斷狀態，而非使用真正的中斷服務函式（ISR）
    // 優點是程式簡單，缺點是可能遺漏快速連續的按鍵事件
    // 在實際應用中，可考慮加入適當的延時或使用中斷服務函式來改善
}

/*****************************************************************
補充說明：

1. 硬體連接：
   - VCC：連接至 3.3V 或 5V（依模組規格）
   - GND：連接至共同接地
   - SDA：連接至 Arduino 的 SDA 腳（A4 或依平台而定）
   - SCL：連接至 Arduino 的 SCL 腳（A5 或依平台而定）
   - INT：連接至 Arduino 的 D2 腳（此範例設定）

2. 按鍵值說明：
   - BMK52T016 支援 16 個按鍵（T016 可能表示 16 個觸控按鍵）
   - readKeyValue() 返回的 16 位元值中，每個位元對應一個按鍵狀態
   - 實際的位元對應關係需參考模組資料手冊

3. 中斷機制：
   - 模組內部偵測到按鍵狀態變化時，會拉低 INT 腳位電平
   - Arduino 透過 getINT() 查詢此狀態，而非使用硬體中斷
   - 這種方式稱為「中斷輪詢」或「狀態查詢」

4. 輸出範例：
   當按下第 0 個和第 2 個按鍵時，序列埠監視器可能顯示：
   keyValue:1111111111111010
   或（取決於位元順序和按鍵按下時的電平定義）
******************************************************************/